<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đơn hàng của tôi</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="../js/checklogin.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .container-orders {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .order {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .order-header h2 {
            margin: 0;
            font-size: 18px;
            color: #007BFF;
        }
        .order-header .status {
            font-weight: bold;
        }
        .product-list {
            margin-top: 10px;
            display: flex; /* Sử dụng flexbox để căn chỉnh sản phẩm */
            flex-direction: column; /* Sắp xếp theo chiều dọc */
        }
        .product {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
            width:100%;
        }
        .product span {
        flex: 1; /* Đảm bảo các phần tử con chiếm đều không gian */
        
        }
        .product:last-child {
            border-bottom: none;
        }
        .total {
            font-weight: bold;
            margin-top: 10px;
        }
        .order-section {
            padding: 20px; /* Thêm khoảng cách bên trong cho toàn bộ phần đơn hàng */
    background-color: #f4f4f4; /* Màu nền nhẹ cho phần đơn hàng */
    margin-top: 80px; / /* Màu nền nhẹ cho phần đơn hàng */
}
.footer{
    margin-top: 300px;
}
    </style>
</head>
<body>
    <!--------------------------------- Menu chính ---------------------->
    <section class="top">
        <div class="container">
            <div class="row">
                <div class="top-logo">
                    <a href="/home.html"><img src="/img/Screenshot_2024-09-28_162555-removebg-preview.png" alt=""></a>
                </div>
                <div class="top-menu-items">
                    <ul>
                        <li><a href="/home.html">Home</a></li>
                        <li>
                            Giáo khoa tham khảo
                            <ul class="top-menu-item">
                                <li><a href="/html-cartegory/manga-comic.html">Manga - Comic</a></li>
                                <li><a href="/html-cartegory/tamly-kinangsong.html">Tâm lý - Kĩ năng sống</a></li>
                                <li><a href="/html-cartegory/sachhocngoaingu.html">Sách học ngoại ngữ</a></li>
                            </ul>
                        </li>
                        <li>
                            VPP - Dụng cụ học sinh
                            <ul class="top-menu-item">
                                <li><a href="/html-cartegory/but-viet.html">Bút - Viết</a></li>
                                <li><a href="/html-cartegory/sanphamvegiay.html">Sản phẩm về giấy</a></li>
                                <li><a href="/html-cartegory/dungcuvanphong.html">Dụng cụ văn phòng</a></li>
                            </ul>
                        </li>
                        <li>
                            Đồ chơi
                            <ul class="top-menu-item">
                                <li><a href="/html-cartegory/dochoigiaoduc.html">Đồ chơi giáo dục</a></li>
                                <li><a href="/html-cartegory/mohinhcacloai.html">Mô hình các loại</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="top-menu-icons">
                    <ul>
                        <li>
                            <div class="search-container">
                                <input type="text" id="searchInput" placeholder="Nhập từ cần tìm">
                                <button type="button" id="searchIcon" class="fas fa-search" onclick="handleSearch()"></button>
                            </div>
                        </li>
                        <li><a href="/login-admin/login.html"><i class="fa-regular fa-user"></i></a></li>
                        <li><a href="/html-cart/cart.html"><i class="fas fa-shopping-cart"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
<!-------------------------- Danh sách đơn hàng --------------------->
    <section class="order-section">
        <section class="container-orders">
            <h1>Danh sách đơn hàng của tôi</h1>
            
            <div class="order">
                <div class="order-header">
                    <h2>ID Đơn hàng: 001</h2>
                    <span class="status">Đang xử lý</span>
                </div>
                <div class="product-list">
                    <div class="product">
                        <span>Tên sản phẩm 1</span>
                        <span>Số lượng: 2</span>
                        <span>Thành tiền: 0 đ</span>
                    </div>
                    <div class="product">
                        <span>Tên sản phẩm 2</span>
                        <span>Số lượng: 1</span>
                        <span>Thành tiền: 0 đ</span>
                    </div>
                </div>
                <div class="total">Tổng tiền: 0 đ</div>
            </div>
            <!-- Thêm các đơn hàng khác ở đây -->
        </section>
    </section>
<!------------------------------------- FOOTER ------------------------------>
<section class="footer">
    <div class="footer-container">
        <p>Truy cập Fanpage <a href="https://www.facebook.com/profile.php?id=61569810176348" target="_blank">Book Haven Store</a></p>
        <div class="app-google">
            <a href="https://www.apple.com/app-store/" target="_blank"><img src="/img/Screenshot 2024-05-15 003849.png" alt=""></a>
            <a href="https://play.google.com/store/games?hl=vi&pli=1" target="_blank"><img src="/img/Screenshot 2024-05-15 003813.png" alt=""></a>
        </div>
        <div class="footer-items">
            <li><a href=""><img src="/img/Screenshot 2024-05-15 003506.png" alt=""></a></li>
            <li><a href="tel:0797268602">Liên hệ</a></li>
            <li><a href="">Giới thiệu</a></li>
            <li><a href="https://www.facebook.com/profile.php?id=61569810176348" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
        </div>
        <div class="footer-text">
            Địa chỉ đăng ký: 254/5, đường Lê Văn Thọ, phường 11, quận Gò Vấp
            Đặt hàng online: 0797268602
        </div>
        <div class="footer-bottom">
            @ Book Haven Store by BOYS Studio
        </div>
    </div>
</section>
<script src="/js/function.js"></script>
<script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBzjS1Zf-rh1txM7KtoiGm5LkdDaWzTh-U",
        authDomain: "store-music-fae02.firebaseapp.com",
        projectId: "store-music-fae02",
        storageBucket: "store-music-fae02.appspot.com",
        messagingSenderId: "35440000355",
        appId: "1:35440000355:web:8a266ed1a96e7c2f812756",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    //Hello
    // Function to fetch orders for the current user
    async function fetchUserOrders(userEmail) {
        const ordersCollection = collection(db, "orders");
        const q = query(ordersCollection, where("useremail", "==", userEmail)); // Assuming you store userId in orders
        const ordersSnapshot = await getDocs(q);
        const ordersList = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

        // Display orders in the container
        const ordersContainer = document.querySelector('.container-orders');
        ordersContainer.innerHTML = ""; // Clear existing orders

        if (ordersList.length === 0) {
            ordersContainer.innerHTML = "<p>Không có đơn hàng nào.</p>";
            return;
        }

        ordersList.forEach(order => {
            const orderDiv = document.createElement('div');
            orderDiv.classList.add('order');
            orderDiv.innerHTML = `
                <div class="order-header">
                    <h2>ID Đơn hàng: ${order.id}</h2>
                    <span class="status">${order.status || 'Đang xử lý'}</span>
                </div>
                <div class="product-list">
                    ${order.items.map(item => `
                        <div class="product">
                            <span>${item.name}</span>
                            <span>Số lượng: ${item.quantity}</span>
                            <span>Thành tiền: ${item.subtotal} đ</span>
                        </div>
                    `).join('')}
                </div>
                <div class="total">Tổng tiền: ${order.total} đ</div>
            `;
            ordersContainer.appendChild(orderDiv);
        });
    }

    // Call the fetchUser Orders function when the user is authenticated
    onAuthStateChanged(auth, (user) => {
        if (user) {
            const userEmail = user.email; // Get the current user's ID
            fetchUserOrders(userEmail); // Fetch orders for the current user
        } else {
            console.log("Người dùng chưa đăng nhập.");
            // Optionally, you can redirect to login page or show a message
        }
    });
</script>
</body>
</html>
